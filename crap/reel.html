<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>TIP</title>
<style>
	#tweets { list-style:none; }
	/*#tweets li { height:120px; }*/
	.noheight { overflow:hidden; height:1px }
</style>
</head>

<body>
<ul id="tweets">
</ul>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script>
	var term = "twitpic";
	var rpp = 3;
	var mostRecent = 0;
	
	function stream() {
		$.getJSON("http://search.twitter.com/search.json?q=" + term + "&rpp=" + rpp + "&since_id=" + mostRecent + "&callback=?",function(msg) {
			console.log(msg);
			for(var r=0;r<msg.results.length;r++) {
				mostRecent = msg.results[r].id;
				var html = "";
				if(msg.results[r].text.indexOf("http://")>-1) {
					var url = msg.results[r].text.split(" ");
					for(var word in url) {
						if(url[word].substr(0,7)=="http://") {
							//console.log(url[word]);	
							var preload = new Image();
							preload.src = "http://localhost:8887/get/" + url[word];
							preload.onload = function() {
								//console.log(url);
								url[word] = "<img height='100' align='left' src='" + this.src + "'>";
								if($("img[src='']").length==0) {
									$("#tweets").prepend("<li class='noheight'>" + url.join(" ") + "</li>");	
									$(".noheight").animate({height:120},300,function() { $(this).removeClass("noheight"); });								
								}
							}
						}
					}
				} else {
					$("#tweets").prepend("<li id='tweet_" + msg.results[r].id + "' class='noheight'>" + msg.results[r].text + "</li>");	
					$(".noheight").animate({height:120},300,function() { $(this).removeClass("noheight"); });
				}
				
			}
		});
	}
	
	setInterval(stream,2000);
</script>
</body>
</html>
